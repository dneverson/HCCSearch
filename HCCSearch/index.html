<!DOCTYPE html>
<html lang="en" dir="ltr" ng-app="MyApp">
<head>
  <meta charset="utf-8">
  <title>HHS - Problems</title>
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
  <link rel="stylesheet" href="../Shared/content/css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="../Shared/content/css/bootstrap-vmctheme.css"/>
  <!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular.min.js"></script>-->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.5/angular-route.min.js"></script>-->
  <script src="../common/angularjs/1.7.5/angular.min.js"></script>
  <script src="../common/angularjs/1.7.5/angular-route.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/MEL_API.js"></script>
  <script src="js/DOM_Functions.js"></script>
  <script src="js/Search.js"></script>
</head>

<body ng-controller="MyCtrl">
  <!-- Logo Banner -->
  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <img class="navbar-logo" src="../Shared/content/img/CMG_logo_white.png" alt="logo" width="50"/>
        <a class="navbar-brand" href="#">Valley Medical Center, A Division of Catalyst Medical Group</a>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Search Bar-->
    <label for="searchText">Weighted Problem Search</label>
    <div class="container well has-feedback search">
      <input placeholder="Weighted Problem Search" type="text" ng-change="initSearch(usrstr)" ng-model="usrstr" ng-model-options="{debounce : 1}" class="form-control" id="searchText" autocomplete="off"/>
      <span class="glyphicon glyphicon-search form-control-feedback"></span>
    </div>
    <div ng-show="isMEL">
      <button style="float: left;" type="button" class="btn btn-primary btn-xs" onclick="toggleHover('currprobs', 'expand')">Hover On/Off</button>
      &nbsp;&nbsp;
      <button style="float: left;" type="button" class="btn btn-primary btn-xs" onclick="expandCurProbTbl('problemsTable', 'hide')">Current Patient Problems</button>
    </div>

    <!-- Current Patient Problems Table-->
    <div class="container well hide" id="problemsTable" ng-show="isMEL"> <!-- container well hide-->
      <div class="row">
        <table class="table table-hover">
          <thead>
            <tr>
              <th class="A">ICD10</th>
              <th class="B">Current Patient Problems</th>
              <th class="C">Weight</th>
              <th class="D"></th>
            </tr>
          </thead>
          <tbody id="currprobs" class="fixedHeadersA expand">
            <tr class="tblRow" ng-mouseover="open=true;" ng-mouseleave="open=false;" ng-repeat="currentproblem in currentProblems | orderBy:'-Weight' track by $index" ng-class="{'color-red': open == true, 'color-grey': currentproblem.Weight === 0 || currentproblem.Weight == '--', 'color-blue': currentproblem.Weight <= 1 && currentproblem.Weight > 0, 'color-green': currentproblem.Weight >= 1}">
              <td class="A">{{currentproblem.ICD10}}</td>
              <td class="B">{{currentproblem.Description}}</td>
              <td class="C">{{currentproblem.Weight}}</td>
              <td class="rowbtn D">
                <button class="btn btn-danger btn-sm" ng-show="open" ng-click="removeButton(currentproblem, currentProblems)">Remove</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p><strong>Total Weight:</strong> {{totalWeight}} | <strong>Results:</strong> {{currentProblems.length}}</p>
      </div>
    </div>

    <!-- Error Messages for User-->
    <div class="container">
      <br><div id="error">Type in the search bar for results.</div>
    </div>

    <!-- Alert Window -->
    <div class="overlay" ng-if="alert.vis"></div>
    <div ng-class="alert.cl" ng-if="alert.vis" ng-click="alert.vis = false;" class="alert alert-dismissible fade in">
      <strong>{{alert.ttl}}</strong> {{alert.msg}}
    </div>

    <!-- Search Results Table-->
    <div class="container well" id="searchTable" style="display:none;">
      <div class="row">
        <table class="table table-hover">
          <thead>
            <tr>
              <th class="A">ICD10</th>
              <th class="B">Description</th>
              <th class="C">Weight</th>
              <th class="D"></th>
            </tr>
          </thead>
          <tbody class="fixedHeadersB expand">
            <tr class="tblRow" ng-mouseover="open=true;" ng-mouseleave="open=false;" ng-repeat="problem in problems | orderBy:'-Weight' track by $index" ng-class="{'color-red': checkList(problem,currentProblems) == true, 'color-grey': problem.Weight === 0, 'color-blue': problem.Weight <= 1 && problem.Weight > 0, 'color-green': problem.Weight >= 1}">
              <td class="A">{{problem.ICD10}}</td>
              <td class="B">{{problem.Description}}</td>
              <td class="C">{{problem.Weight}}</td>
              <td class="rowbtn D">
                <button class="btn btn-success btn-sm" ng-show="open && !checkList(problem,currentProblems) && isMEL" ng-click="addButton(problem)">Add</button>
                <button class="btn btn-danger btn-sm" ng-show="open && checkList(problem,currentProblems) && isMEL" ng-click="removeButton(problem, currentProblems)">Remove</button>
              </td>
            </tr>
          </tbody>
        </table>
        <p><strong>Results:</strong> {{problems.length}}</p>
      </div>
    </div>

    <!-- Testing Purposes Only -->
    <a href="#" onclick='var w=window.open(window.location,"_blank",["menubar=yes","resizable=yes","scrollbars=yes","status=yes","titlebar=yes","toolbar=yes"].join(","));'>Open to IE (for testing only)</a>
  </div>

</body>
</html>
